# 前端开发数据文档

> 本文档从 GPTBots 提供方角度，为前端开发团队提供各环节的静态数据样本与动态数据格式说明。

---

## 目录

1. [系统架构概述](#系统架构概述)
2. [API 接口说明](#api-接口说明)
3. [数据类型定义](#数据类型定义)
4. [GPTBots 流式响应格式](#gptbots-流式响应格式)
5. [业务卡片类型及数据](#业务卡片类型及数据)
6. [静态数据样本](#静态数据样本)
7. [流程阶段字典](#流程阶段字典)

---

## 系统架构概述

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   前端页面   │ ──▶ │   BFF 后端   │ ──▶ │   GPTBots   │ ──▶ │  公积金平台  │
│   (React)   │ ◀── │  (Next.js)  │ ◀── │   智能体    │ ◀── │   (外部)    │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

- **前端**：负责 UI 渲染、用户交互、卡片展示
- **BFF 后端**：负责请求转发、数据处理、与 GPTBots 通信
- **GPTBots**：提供 AI 对话能力，返回结构化响应
- **公积金平台**：提供真实业务数据（由智能体调用）

---

## API 接口说明

### 1. 创建会话

**请求**
```http
POST /api/chat/conversation
Content-Type: application/json

{
  "userId": "U001"
}
```

**响应**
```json
{
  "conversationId": "conv_abc123xyz789"
}
```

---

### 2. 发送消息（流式）

**请求**
```http
POST /api/chat/message
Content-Type: application/json

{
  "conversationId": "conv_abc123xyz789",
  "messages": [
    {
      "role": "user",
      "content": "我想提取公积金"
    }
  ]
}
```

**响应** (SSE 流式)
```
data: {"code":3,"message":"Text","data":{"text":"好的"}}

data: {"code":3,"message":"Text","data":{"text":"，我来帮您查询"}}

data: {"code":10,"message":"FlowOutput","data":{"text":"{\"card_type\":\"auth\",\"card_message\":\"请完成授权\",\"content\":\"请先完成信息授权\"}"}}

data: {"code":0,"message":"End","data":{}}
```

---

### 3. 获取账户信息

**请求**
```http
GET /api/account/info?userId=U001
```

**响应**
```json
{
  "success": true,
  "data": {
    "personalAccount": "12****789",
    "openDate": "2020-05-05",
    "paidUntil": "2022-05",
    "idType": "身份证",
    "idNumber": "35**************345",
    "residence": "福州",
    "maritalStatus": "已婚",
    "phone": "157****9013",
    "bankName": "中国工商银行",
    "bankAccount": "6214 **** **** 1234",
    "accountType": "公积金账户",
    "accountStatus": "封存",
    "sealDate": "2022-06-05",
    "depositBase": 5000.00,
    "personalRate": "12%",
    "personalAmount": 600.00,
    "companyRate": "12%",
    "companyAmount": 600.00,
    "companyName": "福州测试公司",
    "companyAccount": "12**********123",
    "totalBalance": 72000.00
  }
}
```

---

### 4. 获取/更新用户属性

**获取用户属性**
```http
GET /api/user/attribute?userId=U001
```

**响应**
```json
{
  "success": true,
  "data": {
    "user_id": "U001",
    "city": "福州",
    "phase": "1015",
    "is_auth": true,
    "is_married": true,
    "permit_extract_types": ["租房", "购房", "还贷"],
    "sms_signed": false,
    "bank_card_signed": false
  }
}
```

**更新用户属性**
```http
PUT /api/user/attribute
Content-Type: application/json

{
  "userId": "U001",
  "attributeName": "phase",
  "value": "1016"
}
```

---

## 数据类型定义

### 消息类型 (Message)

```typescript
interface Message {
  id: string                    // 消息唯一ID
  role: "user" | "assistant"    // 角色：用户/助手
  content: string               // 消息文本内容
  timestamp: Date               // 时间戳
  
  // AI 思考过程（来自 <think> 标签）
  thinking?: string
  thinkingComplete?: boolean
  
  // 动画状态
  isThinking?: boolean          // 显示思考中动画
  isQuerying?: boolean          // 显示查询中动画
  
  // LLM 结构化卡片
  llmCardType?: LLMCardType     // 卡片类型
  llmCardMessage?: string       // 卡片消息内容
  
  // 账户信息（用于 gjj_details 卡片）
  accountInfo?: AccountInfo
  
  // 授权相关
  authCompleted?: boolean       // 授权是否完成
  permitExtractTypes?: string[] // 可办理的提取类型
}
```

### 卡片类型 (LLMCardType)

```typescript
// 提示卡片类型
type LLMAlertCardType = "warning" | "success" | "info" | "error"

// 业务流程卡片类型
type LLMBusinessCardType = 
  | "auth"              // 提取流程授权（授权后显示提取业务选项）
  | "processing_auth"   // 查询公积金授权（授权后只显示"授权成功"）
  | "sms_sign"          // 手机号签约
  | "bank_sign"         // 银行卡签约
  | "finish"            // 完成/提交卡片
  | "gjj_details"       // 公积金账户详情

type LLMCardType = LLMAlertCardType | LLMBusinessCardType | null
```

### LLM 响应格式 (LLMResponse)

```typescript
interface LLMResponse {
  card_type?: LLMCardType   // 卡片类型（可选）
  card_message?: string     // 卡片附带消息（可选）
  content: string           // 主要回复内容
}
```

### 账户信息 (AccountInfo)

```typescript
interface AccountInfo {
  personalAccount: string   // 个人账户
  openDate: string          // 开户日期
  paidUntil: string         // 缴至年月
  idType: string            // 证件类型
  idNumber: string          // 证件号码
  residence: string         // 现户籍
  maritalStatus: string     // 婚姻状况
  phone: string             // 手机号码
  bankName: string          // 签约银行
  bankAccount: string       // 银行卡号
  accountType: string       // 账户类型
  accountStatus: string     // 账户状态
  sealDate?: string         // 封存日期（可选）
  depositBase: number       // 个人缴存基数
  personalRate: string      // 个人缴存比例
  personalAmount: number    // 个人缴存金额
  companyRate: string       // 单位缴存比例
  companyAmount: number     // 单位缴存金额
  companyName: string       // 单位名称
  companyAccount: string    // 单位账号
}
```

### 用户基本信息 (UserBasicInfo)

```typescript
interface UserBasicInfo {
  name: string        // 姓名
  phone: string       // 手机号
  idType: string      // 证件类型
  idNumber: string    // 证件号码
}
```

---

## GPTBots 流式响应格式

### 流式事件码说明

| code | message | 描述 | data 结构 |
|------|---------|------|-----------|
| 3 | Text | 文本内容 | `{ "text": "..." }` |
| 10 | FlowOutput | 业务流程输出 | `{ "text": "{JSON字符串}" }` |
| 0 | End | 流结束标识 | `{}` |
| 4 | Cost | 消耗统计 | `{ "tokens": 123 }` |
| 11 | MessageInfo | 消息元信息 | `{ "message_id": "..." }` |
| 39 | Audio | 语音消息 | `{ "audio": "base64...", "transcript": "..." }` |

### 流式响应示例

#### 普通文本回复
```
data: {"code":3,"message":"Text","data":{"text":"您好"}}

data: {"code":3,"message":"Text","data":{"text":"，"}}

data: {"code":3,"message":"Text","data":{"text":"我是公积金智能助手"}}

data: {"code":0,"message":"End","data":{}}
```

#### 带卡片的回复（FlowOutput）
```
data: {"code":10,"message":"FlowOutput","data":{"text":"{\"card_type\":\"auth\",\"card_message\":\"请完成个人信息授权\",\"content\":\"为了帮您办理公积金提取业务，需要您先完成信息授权。\"}"}}

data: {"code":0,"message":"End","data":{}}
```

#### 带思考过程的回复
```
data: {"code":3,"message":"Text","data":{"text":"<think>"}}

data: {"code":3,"message":"Text","data":{"text":"用户想要提取公积金，我需要先检查授权状态..."}}

data: {"code":3,"message":"Text","data":{"text":"</think>"}}

data: {"code":3,"message":"Text","data":{"text":"好的，我来帮您办理公积金提取。"}}

data: {"code":0,"message":"End","data":{}}
```

---

## 业务卡片类型及数据

### 1. 授权卡片 (auth / processing_auth)

**触发条件**：用户需要进行信息授权时

**GPTBots 返回格式**
```json
{
  "card_type": "auth",
  "card_message": "请完成个人信息查询报送授权",
  "content": "为了帮您办理公积金提取业务，需要您先完成信息授权。请仔细阅读授权书内容并确认。"
}
```

**前端需要的数据**
```typescript
{
  userInfo: {
    name: "张三",
    phone: "157****9013",
    idType: "身份证",
    idNumber: "35**************345"
  },
  // auth 类型：授权后显示可办理的业务
  permitExtractTypes: ["租房", "购房", "还贷"],
  // processing_auth 类型：授权后只显示"授权成功"
  isProcessingAuth: false
}
```

**卡片状态流转**
```
未授权 → 勾选同意 → 点击确认 → 授权成功
         ↓
      auth: 显示可办理业务列表
      processing_auth: 仅显示"授权成功"
```

---

### 2. 手机签约卡片 (sms_sign)

**触发条件**：用户未完成手机号签约

**GPTBots 返回格式**
```json
{
  "card_type": "sms_sign",
  "card_message": "您还未完成手机号签约，请点击卡片完成签约后继续办理。",
  "content": "办理公积金提取需要先完成手机号签约。"
}
```

**前端需要的数据**
```typescript
{
  message: "您还未完成手机号签约，请点击卡片完成签约后继续办理。",
  userInfo: {
    name: "张三",
    phone: "157****9013",
    idType: "身份证",
    idNumber: "35**************345"
  },
  signType: "phone"
}
```

**卡片状态流转**
```
提示卡片 → 点击"去签约" → 翻转到签约页 → 勾选协议 → 确认签约 → 签约成功
```

---

### 3. 银行卡签约卡片 (bank_sign)

**触发条件**：用户未完成银行卡签约

**GPTBots 返回格式**
```json
{
  "card_type": "bank_sign",
  "card_message": "您还未完成银行卡签约，请点击卡片完成签约后继续办理。",
  "content": "办理公积金提取需要先完成银行卡签约，用于接收提取款项。"
}
```

**前端需要的数据**
```typescript
{
  message: "您还未完成银行卡签约，请点击卡片完成签约后继续办理。",
  userInfo: {
    name: "张三",
    phone: "157****9013",
    idType: "身份证",
    idNumber: "35**************345"
  },
  signType: "bank"
}
```

---

### 4. 公积金详情卡片 (gjj_details)

**触发条件**：用户查询公积金账户信息

**GPTBots 返回格式**
```json
{
  "card_type": "gjj_details",
  "card_message": "用户的账号详细信息：{\"personalAccount\":\"12****789\",\"openDate\":\"2020-05-05\",\"paidUntil\":\"2022-05\",\"idType\":\"身份证\",\"idNumber\":\"35**************345\",\"residence\":\"福州\",\"maritalStatus\":\"已婚\",\"phone\":\"157****9013\",\"bankName\":\"中国工商银行\",\"bankAccount\":\"6214 **** **** 1234\",\"accountType\":\"公积金账户\",\"accountStatus\":\"封存\",\"sealDate\":\"2022-06-05\",\"depositBase\":5000,\"personalRate\":\"12%\",\"personalAmount\":600,\"companyRate\":\"12%\",\"companyAmount\":600,\"companyName\":\"福州测试公司\",\"companyAccount\":\"12**********123\"}",
  "content": "以下是您的公积金账户详细信息："
}
```

**前端需要的数据**
```typescript
{
  accountInfo: {
    personalAccount: "12****789",
    openDate: "2020-05-05",
    paidUntil: "2022-05",
    idType: "身份证",
    idNumber: "35**************345",
    residence: "福州",
    maritalStatus: "已婚",
    phone: "157****9013",
    bankName: "中国工商银行",
    bankAccount: "6214 **** **** 1234",
    accountType: "公积金账户",
    accountStatus: "封存",
    sealDate: "2022-06-05",
    depositBase: 5000.00,
    personalRate: "12%",
    personalAmount: 600.00,
    companyRate: "12%",
    companyAmount: 600.00,
    companyName: "福州测试公司",
    companyAccount: "12**********123"
  },
  // 可选：显示可办理的业务
  permitExtractTypes: ["租房", "购房", "还贷"]
}
```

---

### 5. 完成卡片 (finish)

**触发条件**：用户满足提取条件，进入最终提交流程

**GPTBots 返回格式**
```json
{
  "card_type": "finish",
  "card_message": "您已满足租房提取条件，可以提交申请。",
  "content": "恭喜您！经系统核验，您符合租房提取条件。请确认以下信息并提交申请。"
}
```

**前端需要的数据**
```typescript
{
  message: "您已满足租房提取条件，可以提交申请。",
  accountInfo: { /* AccountInfo */ },
  extractType: "租房",
  
  // 提交流程所需的 Mock 数据
  mockData: {
    gjjAccount: "14**************021",
    accountType: "住房公积金",
    name: "张*三",
    accountStatus: "正常",
    balance: "72,000元",
    maritalStatus: "已婚",
    extractReason: "租房提取",
    bankName: "中国工商银行",
    bankAccount: "2889***8928",
    extractAmount: "1500元",
    signedPhone: "133****3355"
  }
}
```

**卡片状态流转**
```
详情确认 → 输入验证码 → 提交申请 → 人脸认证 → 核对中 → 提交成功 → 查看记录
```

---

### 6. 提示卡片 (warning / success / info / error)

**GPTBots 返回格式**
```json
{
  "card_type": "warning",
  "card_message": "您的账户已封存，无法办理提取业务。如有疑问请联系当地公积金中心。",
  "content": "很抱歉，经系统核验发现您当前无法办理公积金提取。"
}
```

**卡片配置**
```typescript
const cardConfig = {
  warning: {
    title: "提示",
    iconColor: "text-amber-500",
    borderColor: "border-gray-200"
  },
  success: {
    title: "成功",
    iconColor: "text-green-500",
    borderColor: "border-green-200"
  },
  info: {
    title: "提示",
    iconColor: "text-blue-500",
    borderColor: "border-blue-200"
  },
  error: {
    title: "错误",
    iconColor: "text-red-500",
    borderColor: "border-red-200"
  }
}
```

---

## 静态数据样本

### 用户数据

```json
[
  {
    "id": 1,
    "user_id": "U001",
    "name": "张三",
    "id_card": "350102199001011234",
    "phone": "13800138001",
    "password": "admin123"
  },
  {
    "id": 2,
    "user_id": "U002",
    "name": "李四",
    "id_card": "350102199202022345",
    "phone": "13800138002",
    "password": "admin123"
  },
  {
    "id": 3,
    "user_id": "U003",
    "name": "王五",
    "id_card": "350102199303033456",
    "phone": "13800138003",
    "password": "admin123"
  },
  {
    "id": 4,
    "user_id": "U004",
    "name": "赵六",
    "id_card": "350102199404044567",
    "phone": "13800138004",
    "password": "admin123"
  }
]
```

### 账户信息数据

```json
[
  {
    "user_id": "U001",
    "personal_account": "12****789",
    "open_date": "2020-05-05",
    "paid_until": "2022-05",
    "id_type": "身份证",
    "id_number": "35**************345",
    "residence": "福州",
    "marital_status": "已婚",
    "phone": "157****9013",
    "bank_name": "中国工商银行",
    "bank_account": "6214 **** **** 1234",
    "account_type": "公积金账户",
    "account_status": "封存",
    "seal_date": "2022-06-05",
    "deposit_base": 5000.00,
    "personal_rate": "12%",
    "personal_amount": 600.00,
    "company_rate": "12%",
    "company_amount": 600.00,
    "company_name": "福州测试公司",
    "company_account": "12**********123",
    "total_balance": 72000.00
  },
  {
    "user_id": "U002",
    "personal_account": "12****456",
    "open_date": "2019-03-15",
    "paid_until": "2024-11",
    "id_type": "身份证",
    "id_number": "35**************678",
    "residence": "厦门",
    "marital_status": "未婚",
    "phone": "138****2002",
    "bank_name": "中国建设银行",
    "bank_account": "6227 **** **** 5678",
    "account_type": "公积金账户",
    "account_status": "正常",
    "seal_date": null,
    "deposit_base": 8000.00,
    "personal_rate": "12%",
    "personal_amount": 960.00,
    "company_rate": "12%",
    "company_amount": 960.00,
    "company_name": "厦门科技有限公司",
    "company_account": "35**********456",
    "total_balance": 138240.00
  },
  {
    "user_id": "U003",
    "personal_account": "12****321",
    "open_date": "2021-08-20",
    "paid_until": "2024-11",
    "id_type": "身份证",
    "id_number": "35**************901",
    "residence": "泉州",
    "marital_status": "已婚",
    "phone": "159****3003",
    "bank_name": "中国农业银行",
    "bank_account": "6228 **** **** 9012",
    "account_type": "公积金账户",
    "account_status": "正常",
    "seal_date": null,
    "deposit_base": 6500.00,
    "personal_rate": "10%",
    "personal_amount": 650.00,
    "company_rate": "10%",
    "company_amount": 650.00,
    "company_name": "泉州贸易有限公司",
    "company_account": "35**********789",
    "total_balance": 50700.00
  },
  {
    "user_id": "U004",
    "personal_account": "12****654",
    "open_date": "2018-01-10",
    "paid_until": "2023-08",
    "id_type": "身份证",
    "id_number": "35**************234",
    "residence": "漳州",
    "marital_status": "离异",
    "phone": "186****4004",
    "bank_name": "招商银行",
    "bank_account": "6225 **** **** 3456",
    "account_type": "公积金账户",
    "account_status": "封存",
    "seal_date": "2023-09-01",
    "deposit_base": 4500.00,
    "personal_rate": "8%",
    "personal_amount": 360.00,
    "company_rate": "8%",
    "company_amount": 360.00,
    "company_name": "漳州物流有限公司",
    "company_account": "35**********012",
    "total_balance": 48960.00
  }
]
```

### 用户属性数据

```json
[
  {
    "user_id": "U001",
    "city": "福州",
    "phase": "1015",
    "is_auth": true,
    "is_married": true,
    "spouse_authorized": true,
    "history_extract_types": ["租房"],
    "permit_extract_types": ["租房", "购房", "还贷"],
    "can_extract": true,
    "cannot_extract_reason": null,
    "sms_signed": true,
    "bank_card_signed": true
  },
  {
    "user_id": "U002",
    "city": "泉州",
    "phase": "1000",
    "is_auth": false,
    "is_married": false,
    "spouse_authorized": false,
    "history_extract_types": [],
    "permit_extract_types": ["租房", "购房", "还贷", "离职", "退休"],
    "can_extract": true,
    "cannot_extract_reason": null,
    "sms_signed": false,
    "bank_card_signed": false
  },
  {
    "user_id": "U003",
    "city": "厦门",
    "phase": "1018",
    "is_auth": true,
    "is_married": false,
    "spouse_authorized": false,
    "history_extract_types": ["购房"],
    "permit_extract_types": ["购房", "还贷"],
    "can_extract": true,
    "cannot_extract_reason": null,
    "sms_signed": true,
    "bank_card_signed": false
  },
  {
    "user_id": "U004",
    "city": "莆田",
    "phase": "1000",
    "is_auth": true,
    "is_married": true,
    "spouse_authorized": false,
    "history_extract_types": [],
    "permit_extract_types": ["租房", "购房"],
    "can_extract": true,
    "cannot_extract_reason": null,
    "sms_signed": false,
    "bank_card_signed": false
  }
]
```

### 提取记录数据

```json
[
  {
    "id": "EXT202411270001",
    "type": "租房提取",
    "amount": "1,500.00",
    "status": "pending",
    "statusText": "审核中",
    "date": "2024-11-27"
  },
  {
    "id": "EXT202410150002",
    "type": "租房提取",
    "amount": "1,500.00",
    "status": "success",
    "statusText": "提取成功",
    "date": "2024-10-15"
  },
  {
    "id": "EXT202409120003",
    "type": "租房提取",
    "amount": "1,500.00",
    "status": "success",
    "statusText": "提取成功",
    "date": "2024-09-12"
  },
  {
    "id": "EXT202408080004",
    "type": "购房提取",
    "amount": "50,000.00",
    "status": "success",
    "statusText": "提取成功",
    "date": "2024-08-08"
  }
]
```

---

## 流程阶段字典

| 编号 | 阶段 | 描述 | GPTBots 返回示例 |
|------|------|------|------------------|
| 1000 | 未开始 | 初始状态 | - |
| 1001 | 开始办理 | 用户表达办理意图 | - |
| 1002 | 未提取前校验 | 等待校验 | - |
| 1003 | 提取前校验不通过 | 校验失败 | `{"card_type":"warning","card_message":"校验不通过原因..."}` |
| 1004 | 提取前校验通过 | 校验成功 | - |
| 1005 | 未检验婚姻 | 等待婚姻状态检验 | - |
| 1006 | 未婚 | 婚姻状态：未婚 | - |
| 1007 | 已婚 | 婚姻状态：已婚 | - |
| 1008 | 配偶未手机签约 | 配偶需要签约 | - |
| 1009 | 配偶完成签约 | 配偶签约成功 | - |
| 1010 | 配偶已手机签约 | 配偶已签约 | - |
| 1011 | 配偶未完成信息授权 | 配偶需要授权 | `{"card_type":"auth","card_message":"请配偶完成授权"}` |
| 1012 | 配偶已完成信息授权 | 配偶已授权 | - |
| 1013 | 账户状态异常 | 账户冻结/注销 | `{"card_type":"error","card_message":"账户状态异常，无法办理"}` |
| 1014 | 账户状态正常 | 账户正常 | - |
| **1015** | **本人未手机签约** | 需要手机签约 | `{"card_type":"sms_sign","card_message":"请点击手机号签约卡片完成签约"}` |
| 1016 | 本人完成手机签约 | 手机签约成功 | - |
| 1017 | 本人已手机签约 | 已签约 | - |
| **1018** | **本人未银行卡签约** | 需要银行卡签约 | `{"card_type":"bank_sign","card_message":"请点击银行卡签约卡片完成签约"}` |
| 1019 | 本人完成银行卡签约 | 银行卡签约成功 | - |
| 1020 | 本人已银行卡签约 | 已签约 | - |
| 1021 | 多孩家庭 | 需线下办理 | `{"card_type":"info","card_message":"多孩家庭需线下办理"}` |
| 1022 | 非多孩家庭 | 继续流程 | - |
| 1023 | 提取/缴纳 不通过 | 校验失败 | `{"card_type":"warning","card_message":"近期已提取或未连续缴纳"}` |
| 1024 | 提取/缴纳 通过 | 校验成功 | - |
| 1025 | 缴存地无房产 | 满足条件 | - |
| 1026 | 缴存地有房产 | 不满足租房提取 | `{"card_type":"warning","card_message":"缴存地有房产，不满足租房提取条件"}` |
| 1027 | 无未结清贷款 | 满足条件 | - |
| 1028 | 有未结清贷款 | 不满足条件 | `{"card_type":"warning","card_message":"有未结清贷款，无法办理"}` |
| **1029** | **满足租房提取条件** | 可以提交申请 | `{"card_type":"finish","card_message":"满足提取条件"}` |
| 1030 | 人脸识别 | 等待人脸认证 | - |
| 1031 | 提交成功 | 流程完成 | `{"card_type":"success","card_message":"提交成功，请等待审核"}` |

> **注**：带有 `card_type` 的阶段会触发前端渲染对应的业务卡片

---

## 前端处理流程建议

### 1. 消息解析流程

```typescript
function parseAssistantMessage(content: string): ParsedMessage {
  // 1. 尝试解析为 JSON 格式
  const jsonMatch = content.match(/\{[\s\S]*\}/)
  if (jsonMatch) {
    try {
      const parsed = JSON.parse(jsonMatch[0])
      if ('content' in parsed) {
        return {
          cardType: parsed.card_type || null,
          cardMessage: parsed.card_message || '',
          content: parsed.content
        }
      }
    } catch {}
  }
  
  // 2. 纯文本消息
  return {
    cardType: null,
    cardMessage: '',
    content: content
  }
}
```

### 2. 卡片渲染逻辑

```typescript
function renderCard(message: Message) {
  const { llmCardType, llmCardMessage, accountInfo, userInfo } = message
  
  switch (llmCardType) {
    case 'auth':
    case 'processing_auth':
      return <AuthCard userInfo={userInfo} isProcessingAuth={llmCardType === 'processing_auth'} />
    
    case 'sms_sign':
      return <SignCard signType="phone" message={llmCardMessage} userInfo={userInfo} />
    
    case 'bank_sign':
      return <SignCard signType="bank" message={llmCardMessage} userInfo={userInfo} />
    
    case 'gjj_details':
      return <AccountDetailsCard accountInfo={accountInfo} />
    
    case 'finish':
      return <FinishCard message={llmCardMessage} accountInfo={accountInfo} />
    
    case 'warning':
    case 'success':
    case 'info':
    case 'error':
      return <LLMCard type={llmCardType} message={llmCardMessage} />
    
    default:
      return null
  }
}
```

### 3. 流式响应处理

```typescript
async function handleStreamResponse(response: Response) {
  const reader = response.body.getReader()
  const decoder = new TextDecoder()
  let buffer = ''
  let content = ''
  
  while (true) {
    const { done, value } = await reader.read()
    if (done) break
    
    buffer += decoder.decode(value, { stream: true })
    const lines = buffer.split('\n')
    buffer = lines.pop() || ''
    
    for (const line of lines) {
      if (line.startsWith('data: ')) {
        const data = JSON.parse(line.slice(6))
        
        switch (data.code) {
          case 3: // Text
            content += data.data.text
            updateMessage(content)
            break
          
          case 10: // FlowOutput
            const parsed = JSON.parse(data.data.text)
            handleCardResponse(parsed)
            break
          
          case 0: // End
            finalizeMessage()
            break
        }
      }
    }
  }
}
```

---

## 联系方式

如有疑问，请联系 GPTBots 技术支持团队。
